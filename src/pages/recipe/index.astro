---
import Layout from "@/layouts/Layout.astro";
import { singleRecipeData } from "@/data/recipe";
import { Image } from "astro:assets";
import { Card } from "@/components/ui/card";
import { RecipeContent } from "@/components/patterns/recipe-content";
import { Separator } from "@/components/ui/separator";

const recipeId = Astro.url.searchParams.get("id")! || "";

// const apiBaseUrl = import.meta.env.RECIPES_API_URL;
// const apiId = import.meta.env.RECIPES_API_ID;
// const apiSecret = import.meta.env.RECIPES_API_SECRET;

// const response = await fetch(
//   `${apiBaseUrl}/recipes/v2/${recipeId}?type=public&app_id=${apiId}&app_key=${apiSecret}`
// );
// const data: typeof singleRecipeData = await response.json();

const data = singleRecipeData;
---

<Layout title={`PaletPilot | ${data.recipe.label}`}>
  <main class="container mt-12">
    <Card className="p-16">
      <Image
        class="scroll-m-20 rounded-full mx-auto"
        src={data.recipe.image}
        alt={data.recipe.label}
        width={data.recipe.image.length > 0 ? 300 : 0}
        height={data.recipe.image.length > 0 ? 300 : 0}
        loading="eager"
      />
      <h1
        class="scroll-m-20 text-4xl font-bold tracking-tight text-center my-4"
      >
        {data.recipe.label}
      </h1>
      <Separator/>
      <h2 class="scroll-m-20 text-2xl tracking-tight text-center text-muted-foreground my-4">
        Nutrimental facts
      </h2>
        <div class="flex h-12 items-center space-x-4 text-sm justify-center text-muted-foreground mb-4">
          <div class="flex flex-col items-center">
            <div>{Math.round(data.recipe.calories)}kcal</div>
            <span class="font-bold">Calories</span>
          </div>
          <Separator orientation="vertical"/>
          <div class="flex flex-col items-center">
            <div> {data.recipe.totalNutrients.FAT.quantity.toFixed(2)}g </div>
            <span class="font-bold">Fat</span>
          </div>
          <Separator orientation="vertical" className=""/>

          <div class="flex flex-col items-center">
            <div> {data.recipe.totalNutrients.PROCNT.quantity.toFixed(2)}g </div>
            <span class="font-bold">Protein</span>
          </div>
          <Separator orientation="vertical"/>

          <div class="flex flex-col items-center">
            <div> {data.recipe.totalNutrients.CHOCDF.quantity.toFixed(2)}g </div>
            <span class="font-bold">Carbs</span>
          </div>
        </div>
      <Separator/>

      <RecipeContent client:visible/>
    </Card>
    {JSON.stringify(data)}
  </main>
</Layout>
